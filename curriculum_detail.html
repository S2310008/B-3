<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シラバス</title>
    <link rel="stylesheet" href="detail.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="slide-menu" id="slide-menu">
        <button class="close-button" id="close-button">&times;</button>
        <ul>
            <li><a href="home.html">ホーム</a></li>
            <li><a href="tanikeisan.html">単位取得内訳</a></li>
            <li><a href="index.html">科目検索（曜日・科目名から）</a></li>
            <li><a href="curriculum_map.html">科目検索（カリキュラムから）</a></li>
            <li><a href="tanisimulation.html">予定とシミュレーション</a></li>
        </ul>
    </nav>
    <div class="overlay" id="overlay"></div>

    <div class="header">
        <div class="fusen-2">
            <span class="home-text">シラバス</span>
        </div>
        <div class="header-right">
            <div class="date" id="current-date"></div>
            <button class="menu-button" aria-label="メニューを開く">
                <img src="image/ハンバーガーメニュー.svg" alt="メニューアイコン">
            </button>
        </div>
    </div>

    <div class="container">
        <div class="loading-message" id="loading">科目情報を読み込み中...</div>
        <div class="error-message" id="error" style="display: none;"></div>
        
        <div id="subject-detail"></div>

        <div class="action-buttons">
            <button class="button-back" onclick="location.href='curriculum_map.html'">カリキュラムへ戻る</button>
            <button class="button-add">予定に追加</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const dateElement = document.getElementById('current-date');
            const today = new Date();
            const year = today.getFullYear();
            const month = (today.getMonth() + 1).toString().padStart(2, '0');
            const day = today.getDate().toString().padStart(2, '0');
            dateElement.textContent = `${year}/${month}/${day}`;
        });
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAMVDs2C7zKjame91CzT3LJkaz9WszBPHU",
            authDomain: "b3app-b0c29.firebaseapp.com",
            databaseURL: "https://b3app-b0c29-default-rtdb.firebaseio.com",
            projectId: "b3app-b0c29",
            storageBucket: "b3app-b0c29.appspot.com",
            messagingSenderId: "1000910332829",
            appId: "1:1000910332829:web:a1bc233e638afed9b90574"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const loadingElement = document.getElementById('loading');
        const errorElement = document.getElementById('error');
        const subjectDetailContainer = document.getElementById('subject-detail');

        const urlParams = new URLSearchParams(window.location.search);
        const subjectCode = urlParams.get('code');

        async function fetchSubjectDetail() {
            if (!subjectCode) {
                loadingElement.style.display = 'none';
                errorElement.textContent = 'エラー: 科目コードが指定されていません。';
                errorElement.style.display = 'block';
                return;
            }

            try {
                const snapshot = await get(ref(database, 'syllabus_subjects/' + subjectCode));
                loadingElement.style.display = 'none';

                if (snapshot.exists()) {
                    const subject = snapshot.val();
                    
                    // innerHTMLを新しいデザインのHTML構造で生成する
                    subjectDetailContainer.innerHTML = `
                        <div class="detail-item">
                            <span class="label">科目名</span>
                            <span class="value">${subject['科目名'] ?? '不明'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">曜限</span>
                            <span class="value">${subject['曜限'] ?? '不明'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">科目コード</span>
                            <span class="value">${subject['時間割コード'] ?? '不明'}</span>
                        </div>
                        
                        <div class="detail-section">
                            <h3 class="label">授業の概要</h3>
                            <p class="value">${subject['授業の概要']?.replace(/\n/g, '<br>') ?? 'なし'}</p>
                        </div>
                        
                        <div class="detail-section">
                            <h3 class="label">関連科目</h3>
                            <p class="value">${subject['関連科目']?.replace(/\n/g, '<br>') ?? 'なし'}</p>
                        </div>
                    `;
                } else {
                    errorElement.textContent = `エラー: 科目コード "${subjectCode}" の情報が見つかりません。`;
                    errorElement.style.display = 'block';
                }
            } catch (error) {
                console.error("データ取得エラー:", error);
                loadingElement.style.display = 'none';
                errorElement.textContent = `情報の読み込みに失敗しました: ${error.message}`;
                errorElement.style.display = 'block';
            }
        }

        fetchSubjectDetail();
    </script>
        <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuButton = document.querySelector('.menu-button');
            const slideMenu = document.getElementById('slide-menu');
            const overlay = document.getElementById('overlay');
            const closeButton = document.getElementById('close-button');

            // メニューを開く
            menuButton.addEventListener('click', () => {
                slideMenu.classList.add('open');
                overlay.classList.add('active');
            });

            // メニューを閉じる（閉じるボタン）
            closeButton.addEventListener('click', () => {
                slideMenu.classList.remove('open');
                overlay.classList.remove('active');
            });

            // メニューを閉じる（オーバーレイ）
            overlay.addEventListener('click', () => {
                slideMenu.classList.remove('open');
                overlay.classList.remove('active');
            });
        });
    </script>

</body>
</html>